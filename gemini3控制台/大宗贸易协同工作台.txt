<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大宗贸易协同工作台 - 网页版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: #f8fafc;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #cbd5e1;
        }

        .message-bubble {
            max-width: 70%;
            transition: all 0.2s ease;
        }
        
        .negotiation-card {
            border-left: 4px solid #f97316;
            background: linear-gradient(to bottom right, #fff7ed, #ffffff);
        }

        .active-nav {
            background-color: #eff6ff;
            color: #2563eb;
            border-right: 3px solid #2563eb;
        }
    </style>
</head>
<body class="h-screen overflow-hidden flex flex-col">

    <!-- Top Navigation Bar -->
    <header class="h-16 bg-white border-b flex items-center justify-between px-6 shrink-0 z-20 shadow-sm">
        <div class="flex items-center gap-8">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                    <svg class="text-white" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                </div>
                <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600">TradeLink Pro</h1>
            </div>
            <nav class="hidden md:flex items-center gap-6 text-sm font-medium text-gray-500">
                <a href="#" class="text-blue-600 border-b-2 border-blue-600 py-5">交易大厅</a>
                <a href="#" class="hover:text-gray-900 transition-colors">我的合同</a>
                <a href="#" class="hover:text-gray-900 transition-colors">物流监控</a>
                <a href="#" class="hover:text-gray-900 transition-colors">结算管理</a>
            </nav>
        </div>
        <div class="flex items-center gap-4">
            <div class="relative">
                <button class="p-2 text-gray-400 hover:bg-gray-100 rounded-full relative">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                    <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
                </button>
            </div>
            <div class="flex items-center gap-3 pl-4 border-l">
                <div class="text-right hidden sm:block">
                    <p class="text-sm font-semibold">华能电力采购中心</p>
                    <p class="text-xs text-gray-500">王志远 (高级交易员)</p>
                </div>
                <div class="w-9 h-9 bg-gray-200 rounded-full overflow-hidden border">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="avatar">
                </div>
            </div>
        </div>
    </header>

    <div class="flex-1 flex overflow-hidden">
        
        <!-- Sidebar: Conversation List -->
        <aside class="w-80 bg-white border-r flex flex-col shrink-0">
            <div class="p-4 border-b">
                <div class="relative">
                    <input type="text" placeholder="搜索供应商或订单号..." class="w-full bg-gray-100 border-none rounded-lg py-2 pl-9 pr-4 text-sm focus:ring-2 focus:ring-blue-500">
                    <svg class="absolute left-3 top-2.5 text-gray-400" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto custom-scrollbar">
                <!-- Active Item -->
                <div class="p-4 active-nav flex gap-3 cursor-pointer">
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 font-bold shrink-0">中煤</div>
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <h3 class="font-semibold text-sm truncate">中煤能源 - 李经理</h3>
                            <span class="text-[10px] text-blue-500 font-medium">10:45</span>
                        </div>
                        <p class="text-xs text-blue-600 truncate mt-1 italic">[议价方案] 5500大卡 动力煤...</p>
                    </div>
                </div>
                <!-- Other Items -->
                <div class="p-4 hover:bg-gray-50 flex gap-3 cursor-pointer border-b transition-colors">
                    <div class="w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center text-emerald-600 font-bold shrink-0">大同</div>
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <h3 class="font-semibold text-sm truncate">大同煤业物流部</h3>
                            <span class="text-[10px] text-gray-400">昨天</span>
                        </div>
                        <p class="text-xs text-gray-500 truncate mt-1">发票已上传，请查收。</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="flex-1 flex flex-col bg-[#f0f2f5] min-w-0">
            <!-- Chat Header -->
            <div class="h-14 bg-white border-b px-6 flex items-center justify-between shrink-0 shadow-sm">
                <div class="flex items-center gap-2">
                    <span class="font-bold text-gray-800">当前对话：中煤能源李经理</span>
                    <span class="px-2 py-0.5 bg-blue-100 text-blue-600 text-[10px] rounded font-medium">合约议价中</span>
                </div>
                <div class="flex gap-4">
                    <button class="text-gray-500 hover:text-blue-600 flex items-center gap-1 text-sm">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                        聊天记录
                    </button>
                    <button class="text-gray-500 hover:text-blue-600 flex items-center gap-1 text-sm">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
                        邀请加入
                    </button>
                </div>
            </div>

            <!-- Messages Stream -->
            <div id="chat-stream" class="flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar">
                <!-- System Message -->
                <div class="flex justify-center">
                    <span class="text-[11px] bg-white border px-4 py-1.5 rounded-full text-gray-500 shadow-sm font-medium">
                        系统：您正在针对 [商品ID: COAL-5500-QHD] 发起询价
                    </span>
                </div>

                <!-- Received -->
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-[10px] font-bold">李</div>
                    <div class="message-bubble bg-white p-4 rounded-2xl rounded-tl-none shadow-sm border border-gray-100">
                        <p class="text-sm text-gray-800 leading-relaxed">王工您好，关于您之前询的5万吨5500大卡动力煤，目前秦皇岛港现货库存充足。由于近期海运费有所上涨，价格我们报 875元/吨（含税，平仓价）。您看意下如何？</p>
                        <span class="text-[10px] text-gray-400 mt-2 block">10:42</span>
                    </div>
                </div>

                <!-- Dynamic Container for New Messages -->
                <div id="dynamic-messages" class="space-y-6"></div>
            </div>

            <!-- Editor / Form Section -->
            <div class="bg-white border-t p-4 min-h-[120px]">
                <div class="max-w-4xl mx-auto flex flex-col gap-3">
                    <!-- Quick Tools -->
                    <div class="flex gap-4 border-b pb-2">
                        <button onclick="toggleNegotiationForm()" class="flex items-center gap-1.5 text-xs font-bold text-orange-600 hover:bg-orange-50 px-3 py-1.5 rounded-md transition-colors border border-orange-200">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>
                            发起议价单
                        </button>
                        <button class="flex items-center gap-1.5 text-xs text-gray-500 hover:text-blue-600 px-3 py-1.5 rounded-md transition-colors">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
                            发送合同附件
                        </button>
                        <button class="flex items-center gap-1.5 text-xs text-gray-500 hover:text-blue-600 px-3 py-1.5 rounded-md transition-colors">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                            修改交货地
                        </button>
                    </div>

                    <!-- Input Area -->
                    <div class="flex gap-4 items-end">
                        <div class="flex-1 relative">
                            <textarea id="main-input" rows="1" placeholder="输入消息回复..." class="w-full bg-gray-50 border-none rounded-xl py-3 px-4 text-sm focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all resize-none custom-scrollbar"></textarea>
                        </div>
                        <button onclick="sendChatMessage()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold text-sm shadow-lg shadow-blue-100 hover:bg-blue-700 transition-all">
                            发送消息
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Sidebar: Product & Form Panel -->
        <aside id="right-panel" class="w-96 bg-white border-l flex flex-col shrink-0">
            <!-- Product Info Tab -->
            <div class="p-6 border-b">
                <h3 class="font-bold text-sm mb-4">关联商品详情</h3>
                <div class="bg-gray-50 rounded-xl p-4 border">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs font-bold text-blue-600">PREMIUM COAL</span>
                        <span class="text-xs text-gray-400">#C5500-24</span>
                    </div>
                    <h4 class="text-sm font-bold mb-3">优质动力煤 (5500 kcal/kg)</h4>
                    <div class="grid grid-cols-2 gap-y-3 gap-x-2">
                        <div>
                            <p class="text-[10px] text-gray-400 uppercase">硫分</p>
                            <p class="text-xs font-medium">≤ 0.6%</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-gray-400 uppercase">水分</p>
                            <p class="text-xs font-medium">≤ 12%</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-gray-400 uppercase">灰分</p>
                            <p class="text-xs font-medium">≤ 20%</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-gray-400 uppercase">付款方式</p>
                            <p class="text-xs font-medium">信用证 / 电汇</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Negotiation Form Overlay -->
            <div id="neg-form-container" class="flex-1 p-6 flex flex-col transition-all duration-300">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="font-bold text-gray-800">结构化议价表单</h3>
                    <span class="text-[10px] text-gray-400 bg-gray-100 px-2 py-0.5 rounded">草稿中</span>
                </div>

                <div class="space-y-5 flex-1">
                    <div class="space-y-2">
                        <label class="text-[11px] font-bold text-gray-500 uppercase tracking-wider">买方期望报价 (元/吨)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400 text-sm">¥</span>
                            <input id="neg-price" type="number" value="860" class="w-full pl-8 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm font-semibold focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                        </div>
                        <p class="text-[10px] text-gray-400">卖方报价：875.00</p>
                    </div>

                    <div class="space-y-2">
                        <label class="text-[11px] font-bold text-gray-500 uppercase tracking-wider">拟购总量 (吨)</label>
                        <input id="neg-qty" type="number" value="50000" class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm font-semibold focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                    </div>

                    <div class="space-y-2">
                        <label class="text-[11px] font-bold text-gray-500 uppercase tracking-wider">交付周期 (天)</label>
                        <select id="neg-days" class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm font-semibold focus:ring-2 focus:ring-blue-500 outline-none appearance-none cursor-pointer">
                            <option value="7">7天内到港</option>
                            <option value="15" selected>15天内到港</option>
                            <option value="30">30天及以上</option>
                        </select>
                    </div>

                    <div class="space-y-2">
                        <label class="text-[11px] font-bold text-gray-500 uppercase tracking-wider">附加条款</label>
                        <textarea id="neg-note" rows="3" placeholder="如：需提供近期化验报告..." class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none resize-none"></textarea>
                    </div>
                </div>

                <div class="pt-6 border-t mt-auto">
                    <button onclick="submitNegotiation()" class="w-full bg-orange-500 text-white py-4 rounded-xl font-bold text-sm shadow-lg shadow-orange-100 hover:bg-orange-600 active:scale-[0.98] transition-all">
                        提交议价方案至对方
                    </button>
                </div>
            </div>
        </aside>
    </div>

    <!-- Notification Toast (Hidden by default) -->
    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full text-sm shadow-2xl opacity-0 pointer-events-none transition-all duration-300 translate-y-4 z-50">
        已成功发送议价方案
    </div>

    <script>
        // 发送普通文字消息
        function sendChatMessage() {
            const input = document.getElementById('main-input');
            const text = input.value.trim();
            if(!text) return;

            const html = `
                <div class="flex items-start gap-3 justify-end message-in">
                    <div class="message-bubble bg-blue-600 text-white p-4 rounded-2xl rounded-tr-none shadow-md">
                        <p class="text-sm leading-relaxed">${text}</p>
                        <span class="text-[10px] opacity-60 mt-2 block text-right">${getCurrentTime()}</span>
                    </div>
                    <div class="w-8 h-8 bg-gray-200 rounded-full overflow-hidden shrink-0">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="avatar">
                    </div>
                </div>
            `;
            
            appendMessage(html);
            input.value = '';
            input.style.height = 'auto';
        }

        // 发送结构化议价方案
        function submitNegotiation() {
            const price = document.getElementById('neg-price').value;
            const qty = document.getElementById('neg-qty').value;
            const days = document.getElementById('neg-days').value;
            const note = document.getElementById('neg-note').value;

            const html = `
                <div class="flex items-start gap-3 justify-end message-in">
                    <div class="message-bubble negotiation-card p-5 rounded-2xl rounded-tr-none shadow-lg border border-orange-100">
                        <div class="flex items-center gap-2 mb-4 text-orange-600">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>
                            <span class="text-sm font-bold">新议价方案提交</span>
                        </div>
                        
                        <div class="space-y-3 mb-4">
                            <div class="flex justify-between items-center bg-white p-2 rounded-lg border border-orange-50">
                                <span class="text-xs text-gray-500">期望成交单价</span>
                                <span class="font-bold text-orange-600">¥${price} / 吨</span>
                            </div>
                            <div class="flex justify-between items-center px-2">
                                <span class="text-xs text-gray-500">拟购数量</span>
                                <span class="text-xs font-semibold">${parseInt(qty).toLocaleString()} 吨</span>
                            </div>
                            <div class="flex justify-between items-center px-2">
                                <span class="text-xs text-gray-500">交货期限</span>
                                <span class="text-xs font-semibold">${days} 天内</span>
                            </div>
                            ${note ? `<div class="px-2 pt-2 border-t border-orange-50 text-[11px] text-gray-500 italic">备注: ${note}</div>` : ''}
                        </div>

                        <div class="grid grid-cols-2 gap-2 mt-4">
                            <button class="bg-white border border-gray-200 text-gray-600 text-[11px] py-2 rounded-lg font-bold hover:bg-gray-50 cursor-not-allowed">修改撤回</button>
                            <div class="bg-orange-100 text-orange-700 text-[11px] flex items-center justify-center rounded-lg font-bold">等待对方回应</div>
                        </div>
                    </div>
                    <div class="w-8 h-8 bg-gray-200 rounded-full overflow-hidden shrink-0">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="avatar">
                    </div>
                </div>
            `;

            appendMessage(html);
            showToast("已成功提交议价方案给卖方");
        }

        function appendMessage(html) {
            const container = document.getElementById('dynamic-messages');
            container.insertAdjacentHTML('beforeend', html);
            scrollToBottom();
        }

        function scrollToBottom() {
            const stream = document.getElementById('chat-stream');
            stream.scrollTo({
                top: stream.scrollHeight,
                behavior: 'smooth'
            });
        }

        function getCurrentTime() {
            return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function showToast(text) {
            const toast = document.getElementById('toast');
            toast.innerText = text;
            toast.style.opacity = '1';
            toast.style.transform = 'translate(-50%, -20px)';
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translate(-50%, 0)';
            }, 3000);
        }

        // 输入框高度自动扩展
        const tx = document.getElementById('main-input');
        tx.addEventListener("input", OnInput, false);
        function OnInput() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + "px";
            if(this.scrollHeight > 150) {
                this.style.overflowY = 'auto';
            } else {
                this.style.overflowY = 'hidden';
            }
        }

        // 回车发送消息 (Shift+Enter 换行)
        tx.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendChatMessage();
            }
        });

        function toggleNegotiationForm() {
            const panel = document.getElementById('right-panel');
            // 此处可以添加折叠逻辑，本演示中默认为开启状态
            showToast("请在右侧侧边栏填写议价单细节");
        }
    </script>
</body>
</html>