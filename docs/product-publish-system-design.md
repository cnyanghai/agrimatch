# 产品发布系统设计方案

> 文档版本：v1.1
> 创建日期：2026-01-26
> 更新日期：2026-01-26
> 状态：后端已实施，前端待适配

## 实施进度

| 步骤 | 状态 | 说明 |
|------|------|------|
| 数据库迁移脚本 | ✅ 完成 | `V20260126_1__add_product_schema.sql` |
| 业态表创建 | ✅ 完成 | 4个业态：feed, poultry, meat, other |
| 产品表扩展 | ✅ 完成 | 添加 schema_code, has_params, allow_custom_name |
| 禽蛋种苗品类 | ✅ 完成 | 种蛋、鸡苗、鸭苗、鹅苗、商品蛋 + 参数模板 |
| 畜禽肉类品类 | ✅ 完成 | 白羽鸡肉、黄羽鸡肉、鸭肉、猪肉、牛肉、羊肉 + 参数模板 |
| 后端 Schema API | ✅ 完成 | `/api/product-schemas`, `/api/product-schemas/tree` |
| 前端 API | ✅ 完成 | `frontend/src/api/productSchema.ts` |
| 前端表单适配 | ⏳ 待实施 | 发布表单按业态动态渲染 |
| 供求大厅改造 | ⏳ 待实施 | 左侧分类按业态分组 |

---

## 一、问题背景

### 1.1 现有系统设计

当前系统采用「产品分类树 + 参数模板」的架构：

```
产品分类树 (nht_product)
    └── 产品参数模板 (nht_product_parameters)
        └── 发布时填写参数 → 存入 params_json
```

**已设计的产品**（大宗农产品）：

| 品类 | 典型参数 | 特点 |
|------|---------|------|
| 玉米 | 容重、水分、不完善粒、生霉粒、粗蛋白、杂质 | 国标明确，可量化 |
| 小麦 | 容重、水分、面筋含量 | 国标明确 |
| 豆粕 | 粗蛋白、水分、粗纤维、脲酶活性 | 期货标准 |

### 1.2 问题产品（非标农产品）

| 品类 | 需要的参数 | 问题 |
|------|-----------|------|
| 种蛋 | 品种、日龄、受精率、存储天数、疫苗情况 | 完全不同的参数体系 |
| 鸡苗 | 品种、日龄、疫苗接种、母代来源、成活率承诺 | 涉及生物特性 |
| 肉产品 | 部位、冷鲜/冷冻、屠宰日期、保质期、加工方式 | 涉及加工和保鲜 |

### 1.3 核心矛盾

现有系统是为**标准化大宗商品**设计的，但农业产品类型多样：

1. **大宗谷物**：参数固定、国标明确 → 适合现有设计
2. **活体/生物类**：参数动态、无统一标准 → 现有设计不适用
3. **加工产品**：参数复杂、涉及加工工艺 → 需要不同的表单结构

---

## 二、深度分析

### 2.1 产品的标准化程度分层

农产品不是非黑即白的"有模板/无模板"，而是一个**标准化程度的光谱**：

```
高度标准化                                              完全非标
    │                                                      │
    ▼                                                      ▼
┌────────┬────────┬────────┬────────┬────────┬────────┬────────┐
│  玉米  │  豆粕  │  种蛋  │  鸡苗  │ 土鸡蛋  │ 特色农产 │ 完全新品 │
│        │        │        │        │        │          │        │
│ 国标明确│ 期货标的│ 行业惯例│ 行业惯例│ 部分标准 │  无标准   │  无标准  │
│ 参数固定│ 参数固定│ 可预设  │ 可预设  │ 需补充   │  自由描述 │ 自由描述 │
└────────┴────────┴────────┴────────┴────────┴────────┴────────┘
     ▲                        ▲                           ▲
     │                        │                           │
  现有系统覆盖             需要扩展                    需要兜底方案
```

### 2.2 用户发布的五种场景

| 场景 | 例子 | 用户期望 | 系统应如何响应 |
|------|------|---------|--------------|
| **精确匹配** | 发布玉米 | 选品类→填参数→发布 | 提供完整模板，最佳体验 |
| **新增标准品** | 发布种蛋 | 希望有专业模板 | 系统预设模板（需要扩展） |
| **细分变体** | 发布"发酵豆粕" | 选豆粕+补充说明 | 支持在标准模板上追加描述 |
| **地域特产** | 发布"溧阳白芹" | 选蔬菜+详细描述 | 提供通用模板+自由描述 |
| **全新品类** | 发布"蚯蚓粪有机肥" | 能发布就行 | 自定义兜底，标签辅助检索 |

### 2.3 核心设计原则

> **不是穷举所有产品，而是设计一个分层容错的系统**

```
                    ┌─────────────────────────────────┐
                    │     用户选择要发布的产品          │
                    └───────────────┬─────────────────┘
                                    │
                    ┌───────────────▼─────────────────┐
                    │  系统是否有这个品类？             │
                    └───────────────┬─────────────────┘
                          ┌─────────┴─────────┐
                          ▼                   ▼
                    ┌─────────┐          ┌─────────┐
                    │   有    │          │   没有   │
                    └────┬────┘          └────┬────┘
                         │                    │
              ┌──────────▼──────────┐   ┌─────▼─────┐
              │ 品类有参数模板吗？    │   │ 搜索相似品类 │
              └──────────┬──────────┘   └─────┬─────┘
               ┌─────────┴─────────┐          │
               ▼                   ▼          ▼
         ┌─────────┐         ┌─────────┐ ┌─────────────┐
         │   有    │         │   没有   │ │ 找到相似？   │
         └────┬────┘         └────┬────┘ └──────┬──────┘
              │                   │       ┌─────┴─────┐
              ▼                   ▼       ▼           ▼
        ┌──────────┐       ┌──────────┐ ┌────┐    ┌────────┐
        │ 展示专业  │       │ 展示通用  │ │ 是 │    │  否    │
        │ 参数表单  │       │ 表单+描述 │ └─┬──┘    └───┬────┘
        └──────────┘       └──────────┘   │            │
                                          ▼            ▼
                                     ┌────────┐  ┌──────────┐
                                     │推荐选择 │  │ 自定义发布│
                                     │相似品类 │  │ +标签系统 │
                                     └────────┘  └──────────┘
```

---

## 三、解决方案

### 3.1 方案架构：三层 + 一兜底

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         产品发布三层架构                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 第一层：业态 (Schema) - 决定表单结构                              │   │
│  │                                                                   │   │
│  │   谷物饲料    禽蛋种苗    畜禽肉类    水产品类    果蔬农资         │   │
│  │   grain      poultry     meat       aquatic    produce          │   │
│  │                                                                   │   │
│  │   每个业态有自己的「基础字段」和「表单布局」                        │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                    │                                    │
│                                    ▼                                    │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 第二层：品类 (Category) - 决定参数模板                            │   │
│  │                                                                   │   │
│  │   玉米  小麦  豆粕 │ 种蛋  鸡苗  鸭苗 │ 鸡肉  猪肉 │ ...          │   │
│  │                                                                   │   │
│  │   每个品类可以有「预设参数」，也可以没有                            │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                    │                                    │
│                                    ▼                                    │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 第三层：参数 (Parameters) - 具体的规格指标                        │   │
│  │                                                                   │   │
│  │   标准参数（下拉选择）  +  自定义参数（自由输入）  +  标签          │   │
│  │                                                                   │   │
│  │   ✓ 任何品类都支持添加自定义参数                                   │   │
│  │   ✓ 标签用于非结构化信息的检索                                     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 兜底层：自定义发布                                                │   │
│  │                                                                   │   │
│  │   当用户找不到合适品类时：                                         │   │
│  │   1. 选择「其他」业态                                              │   │
│  │   2. 输入自定义品类名称                                            │   │
│  │   3. 填写基础字段（名称、数量、价格、图片、描述）                   │   │
│  │   4. 添加标签（便于检索）                                          │   │
│  │   5. 自由添加自定义参数                                            │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 数据结构设计

#### 3.2.1 新增业态表

```sql
-- 业态表（决定表单结构）
CREATE TABLE nht_product_schema (
  id bigint PRIMARY KEY AUTO_INCREMENT,
  schema_code varchar(32) NOT NULL COMMENT '业态代码：grain, poultry, meat, aquatic, produce, other',
  schema_name varchar(64) NOT NULL COMMENT '业态名称',
  form_config_json text COMMENT '表单布局配置JSON',
  icon varchar(128) COMMENT '图标',
  sort int DEFAULT 0 COMMENT '排序',
  status char(1) DEFAULT '0' COMMENT '状态：0正常 1停用',
  create_time datetime DEFAULT CURRENT_TIMESTAMP,
  update_time datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY uk_schema_code (schema_code)
) COMMENT '产品业态表';

-- 初始数据
INSERT INTO nht_product_schema (schema_code, schema_name, form_config_json, icon, sort) VALUES
('grain',    '谷物饲料', '{"sections":["basic","params","logistics"]}', 'icon-grain', 1),
('poultry',  '禽蛋种苗', '{"sections":["breed","biology","trade","logistics"]}', 'icon-poultry', 2),
('meat',     '畜禽肉类', '{"sections":["product","quality","trace","trade"]}', 'icon-meat', 3),
('aquatic',  '水产品类', '{"sections":["breed","spec","trade","logistics"]}', 'icon-fish', 4),
('produce',  '果蔬农资', '{"sections":["basic","spec","trade"]}', 'icon-produce', 5),
('other',    '其他品类', '{"sections":["description","custom","trade"]}', 'icon-other', 99);
```

#### 3.2.2 修改产品分类表

```sql
-- 给 nht_product 添加字段
ALTER TABLE nht_product
  ADD COLUMN schema_code varchar(32) DEFAULT 'grain' COMMENT '所属业态',
  ADD COLUMN has_params tinyint DEFAULT 0 COMMENT '是否有预设参数：0否 1是',
  ADD COLUMN allow_custom_name tinyint DEFAULT 0 COMMENT '是否允许自定义名称：0否 1是';

-- 更新现有数据
UPDATE nht_product SET schema_code = 'grain', has_params = 1 WHERE parent_id IN (1, 18, 27);
```

#### 3.2.3 修改参数表

```sql
-- 给 nht_product_parameters 添加字段
ALTER TABLE nht_product_parameters
  ADD COLUMN param_group varchar(32) DEFAULT 'quality' COMMENT '参数分组：quality/logistics/custom',
  ADD COLUMN placeholder varchar(128) COMMENT '输入提示文字';
```

#### 3.2.4 params_json 存储结构

```json
{
  "standard": {
    "1": "≥720",
    "2": "≤14.0",
    "3": "≤5.0"
  },
  "custom": {
    "产地": "吉林",
    "收获年份": "2025"
  }
}
```

### 3.3 业态与品类的初始配置

```
谷物饲料 (grain) - 现有的，保持不变
├── 玉米 [has_params=1] → 容重、水分、不完善粒、生霉粒、粗蛋白、杂质
├── 小麦 [has_params=1] → 容重、水分、面筋含量...
├── 豆粕 [has_params=1] → 粗蛋白、水分、粗纤维...
├── 菜粕 [has_params=1]
├── 玉米DDGS [has_params=1]
└── 其他谷物 [has_params=0, allow_custom_name=1]

禽蛋种苗 (poultry) - 新增
├── 种蛋 [has_params=1] → 品种、种鸡日龄、受精率承诺、存储天数、疫苗情况
├── 鸡苗 [has_params=1] → 品种、日龄、疫苗接种、成活率承诺、母代来源
├── 鸭苗 [has_params=1]
├── 鹅苗 [has_params=1]
├── 商品蛋 [has_params=1] → 品种、规格、新鲜度、包装方式
└── 其他禽类 [has_params=0, allow_custom_name=1]

畜禽肉类 (meat) - 新增
├── 白羽鸡肉 [has_params=1] → 产品形态、冷鲜/冷冻、部位、屠宰日期、保质期
├── 黄羽鸡肉 [has_params=1]
├── 猪肉 [has_params=1]
├── 牛肉 [has_params=1]
├── 羊肉 [has_params=1]
├── 鸭肉 [has_params=1]
└── 其他肉类 [has_params=0, allow_custom_name=1]

水产品类 (aquatic) - 新增
├── 淡水鱼 [has_params=1] → 品种、规格、养殖/野生、鲜活/冷冻
├── 海水鱼 [has_params=1]
├── 虾类 [has_params=1]
├── 蟹类 [has_params=1]
└── 其他水产 [has_params=0, allow_custom_name=1]

果蔬农资 (produce) - 新增
├── 蔬菜 [has_params=0]
├── 水果 [has_params=0]
├── 有机肥 [has_params=1]
├── 化肥 [has_params=1]
└── 其他农资 [has_params=0, allow_custom_name=1]

其他品类 (other) - 兜底
└── 自定义 [has_params=0, allow_custom_name=1] → 只有基础字段 + 标签 + 自定义参数
```

### 3.4 新增品类的参数模板

#### 3.4.1 种蛋参数

```sql
INSERT INTO nht_product_parameters (product_id, param_name, param_type, options, required, sort, param_group) VALUES
(种蛋ID, '品种', 1, '海兰褐,京红1号,罗曼粉,农大3号,其他', 'Y', 1, 'breed'),
(种蛋ID, '种鸡日龄(周)', 1, '25-30,30-40,40-50,50-60', 'Y', 2, 'biology'),
(种蛋ID, '受精率承诺', 1, '≥95%,≥90%,≥85%', 'N', 3, 'biology'),
(种蛋ID, '存储天数', 1, '≤3天,≤7天,≤10天', 'Y', 4, 'quality'),
(种蛋ID, '疫苗接种情况', 0, NULL, 'N', 5, 'biology');
```

#### 3.4.2 鸡苗参数

```sql
INSERT INTO nht_product_parameters (product_id, param_name, param_type, options, required, sort, param_group) VALUES
(鸡苗ID, '品种', 1, '817肉杂,白羽肉鸡,黄羽肉鸡,蛋鸡苗', 'Y', 1, 'breed'),
(鸡苗ID, '日龄', 1, '1日龄,7日龄,14日龄,21日龄', 'Y', 2, 'biology'),
(鸡苗ID, '疫苗接种', 1, '马立克+新城疫,仅马立克,未接种', 'Y', 3, 'biology'),
(鸡苗ID, '成活率承诺', 1, '≥98%,≥95%,≥90%', 'N', 4, 'quality'),
(鸡苗ID, '母代来源', 0, NULL, 'N', 5, 'breed');
```

#### 3.4.3 肉产品参数

```sql
INSERT INTO nht_product_parameters (product_id, param_name, param_type, options, required, sort, param_group) VALUES
(白羽鸡肉ID, '产品形态', 1, '白条鸡,分割品,深加工品', 'Y', 1, 'product'),
(白羽鸡肉ID, '温度状态', 1, '冷鲜(0-4℃),冷冻(-18℃)', 'Y', 2, 'quality'),
(白羽鸡肉ID, '部位', 1, '整鸡,鸡胸,鸡腿,鸡翅,鸡爪,副产品', 'N', 3, 'product'),
(白羽鸡肉ID, '屠宰日期', 0, NULL, 'Y', 4, 'trace'),
(白羽鸡肉ID, '保质期', 1, '7天,15天,30天,6个月,12个月', 'Y', 5, 'quality');
```

---

## 四、界面设计

### 4.1 供求大厅分类导航

```
┌─────────────────────────────────────────────────────────────┐
│                     供求大厅                                 │
├──────────────┬──────────────────────────────────────────────┤
│              │                                              │
│  品类筛选     │  ┌──────────────────────────────────────┐   │
│              │  │                                      │   │
│  ▼ 谷物饲料   │  │     供应列表                          │   │
│    ○ 全部    │  │                                      │   │
│    ○ 玉米    │  │  ┌────────────────────────────────┐  │   │
│    ○ 小麦    │  │  │ 🌽 东北玉米 | 容重≥720 水分≤14  │  │   │
│    ○ 豆粕    │  │  │ 500吨 | ¥2,450/吨              │  │   │
│    ○ 更多... │  │  └────────────────────────────────┘  │   │
│              │  │                                      │   │
│  ▼ 禽蛋种苗   │  │  ┌────────────────────────────────┐  │   │
│    ○ 种蛋    │  │  │ 🥚 海兰褐种蛋 | 30-40周龄        │  │   │
│    ○ 鸡苗    │  │  │ 10万枚 | ¥3.5/枚               │  │   │
│    ○ 鸭苗    │  │  └────────────────────────────────┘  │   │
│              │  │                                      │   │
│  ▼ 畜禽肉类   │  │  ┌────────────────────────────────┐  │   │
│    ○ 白羽鸡  │  │  │ 🍗 冷冻鸡胸肉 | 冷冻-18℃        │  │   │
│    ○ 猪肉    │  │  │ 20吨 | ¥12,000/吨              │  │   │
│              │  │  └────────────────────────────────┘  │   │
│  ▶ 水产品类   │  │                                      │   │
│              │  │  ┌────────────────────────────────┐  │   │
│  ▶ 其他品类   │  │  │ 📦 蚯蚓粪有机肥                  │  │   │
│    (自定义)  │  │  │ #有机肥 #土壤改良                 │  │   │
│              │  │  │ 100吨 | ¥800/吨                 │  │   │
│              │  │  └────────────────────────────────┘  │   │
│              │  │                                      │   │
└──────────────┴──────────────────────────────────────────────┘
```

**左侧分类的数据来源**：

```typescript
// 从后端获取业态和品类树
const schemaTree = await getProductSchemaTree()

// 结构示例
[
  {
    schemaCode: 'grain',
    schemaName: '谷物饲料',
    categories: [
      { id: 2, name: '玉米', hasParams: true, count: 156 },
      { id: 3, name: '小麦', hasParams: true, count: 42 },
      // ...
    ]
  },
  {
    schemaCode: 'poultry',
    schemaName: '禽蛋种苗',
    categories: [...]
  },
  // ...
  {
    schemaCode: 'other',
    schemaName: '其他品类',
    categories: [
      { id: 999, name: '自定义', hasParams: false, count: 23 }
    ]
  }
]
```

### 4.2 聊天议价的适配设计

```
┌─────────────────────────────────────────────────────────────────┐
│                      聊天议价界面                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              产品信息卡片（统一组件，按类型适配）          │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │                                                         │   │
│  │  【有结构化参数的产品】                                   │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │ 🌽 东北玉米                           供应信息   │   │   │
│  │  ├─────────────────────────────────────────────────┤   │   │
│  │  │ 容重    ≥720 g/L       │  数量    500 吨        │   │   │
│  │  │ 水分    ≤14.0%         │  单价    ¥2,450/吨     │   │   │
│  │  │ 蛋白    ≥7.5%          │  产地    吉林四平      │   │   │
│  │  │ 杂质    ≤0.5%          │  交货    自提          │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  │                                                         │   │
│  │  【无结构化参数的产品（自定义发布）】                      │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │ 📦 蚯蚓粪有机肥                       供应信息   │   │   │
│  │  ├─────────────────────────────────────────────────┤   │   │
│  │  │                                                 │   │   │
│  │  │ 纯蚯蚓粪发酵有机肥，有机质含量≥45%，适用于       │   │   │
│  │  │ 果树、蔬菜等经济作物...                          │   │   │
│  │  │                                                 │   │   │
│  │  │ #有机肥 #蚯蚓粪 #土壤改良 #绿色农业              │   │   │
│  │  │                                                 │   │   │
│  │  │ 数量 100吨  |  单价 ¥800/吨  |  产地 山东       │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  议价功能根据产品类型适配：                                       │
│  - 有参数的产品：可以针对具体参数议价（"水分能否降到13.5？"）       │
│  - 无参数的产品：自由聊天沟通细节                                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4.3 发布流程的完整设计

```
┌─────────────────────────────────────────────────────────────────┐
│                        发布供应信息                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  第一步：选择业态                                                │
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐        │
│  │谷物饲料│ │禽蛋种苗│ │畜禽肉类│ │水产品类│ │其他品类│        │
│  │  ✓    │ │        │ │        │ │        │ │        │        │
│  └────────┘ └────────┘ └────────┘ └────────┘ └────────┘        │
│                                                                 │
│  第二步：选择品类                                                │
│  ┌────────────────────────────────────────────────────────┐    │
│  │  ○ 玉米    ○ 小麦    ○ 豆粕    ○ 菜粕    ○ 其他谷物  │    │
│  │     ✓                                                  │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                 │
│  第三步：填写表单（根据业态和品类动态生成）                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                                         │   │
│  │  ─── 基础信息 ───                                       │   │
│  │  产地    [吉林省四平市          ▼]                      │   │
│  │  数量    [500        ] 吨                               │   │
│  │  价格    [2450       ] 元/吨    ○现货 ○基差             │   │
│  │                                                         │   │
│  │  ─── 规格参数 ───（来自参数模板）                        │   │
│  │  容重    [≥720 ▼]  g/L                                  │   │
│  │  水分    [≤14.0 ▼] %                                    │   │
│  │  蛋白    [≥7.5 ▼]  %                                    │   │
│  │  杂质    [≤0.5 ▼]  %                                    │   │
│  │                                                         │   │
│  │  ─── 自定义参数 ───（可选，任何品类都可添加）             │   │
│  │  [+ 添加自定义参数]                                      │   │
│  │  收获年份  [2025      ]                                 │   │
│  │                                                         │   │
│  │  ─── 物流交付 ───                                       │   │
│  │  包装    [散装 ▼]                                       │   │
│  │  交货    [自提 ▼]                                       │   │
│  │  发货地  [吉林省四平市XX仓库    ]                        │   │
│  │                                                         │   │
│  │  ─── 标签 ───                                           │   │
│  │  [东北玉米] [一等品] [自有仓储] [+ 添加]                  │   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│                              [发布供应]                          │
└─────────────────────────────────────────────────────────────────┘
```

### 4.4 自定义发布的特殊处理

当用户选择"其他品类"时：

```
┌─────────────────────────────────────────────────────────────────┐
│                     发布其他品类                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  品类名称    [蚯蚓粪有机肥              ]                        │
│                                                                 │
│  💡 系统提示：找到相似品类，是否选择？                            │
│     ┌─────────────────────────────────────────┐                 │
│     │  ○ 有机肥（果蔬农资类）                  │                 │
│     │  ○ 继续使用自定义名称                   │                 │
│     └─────────────────────────────────────────┘                 │
│                                                                 │
│  ─── 产品描述 ───（自定义发布必填）                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 纯蚯蚓粪发酵的有机肥料，有机质含量≥45%，氮磷钾总养分      │   │
│  │ ≥5%。适用于果树、蔬菜、花卉等经济作物，可改良土壤结构，   │   │
│  │ 提高土壤肥力...                                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ─── 产品图片 ───                                               │
│  [+ 上传图片] [+ 上传图片] [+ 上传图片]                          │
│                                                                 │
│  ─── 自定义参数 ───                                             │
│  [+ 添加参数]                                                   │
│  有机质含量  [≥45%      ]                                       │
│  氮磷钾总养分 [≥5%       ]                                       │
│  水分        [≤30%      ]                                       │
│                                                                 │
│  ─── 交易信息 ───                                               │
│  数量    [100       ] 吨                                        │
│  价格    [800       ] 元/吨                                     │
│                                                                 │
│  ─── 标签 ───（重要！用于检索）                                  │
│  [有机肥] [蚯蚓粪] [土壤改良] [绿色农业] [+ 添加]                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 五、方案总结

### 5.1 场景覆盖

| 用户场景 | 系统如何处理 | 体验等级 |
|---------|-------------|---------|
| 发布玉米、豆粕等 | 完整参数模板，下拉选择 | ⭐⭐⭐⭐⭐ 最佳 |
| 发布种蛋、鸡苗等 | 新增参数模板（需扩展） | ⭐⭐⭐⭐⭐ 最佳 |
| 发布"特级豆粕" | 选豆粕 + 自定义参数补充 | ⭐⭐⭐⭐ 良好 |
| 发布系统没有的品类 | 搜索相似 → 自定义发布 | ⭐⭐⭐ 可用 |
| 发布完全新品类 | 自定义发布 + 标签 + 描述 | ⭐⭐⭐ 可用 |

### 5.2 核心改动点

| 层级 | 改动内容 | 工作量 |
|------|---------|--------|
| **数据库** | 新增 `nht_product_schema` 表 | 小 |
| **数据库** | `nht_product` 添加 `schema_code` 字段 | 小 |
| **数据库** | 为新品类预设参数模板 | 中 |
| **后端** | 新增 Schema 相关 API | 中 |
| **后端** | 修改发布接口支持业态 | 小 |
| **前端** | 发布表单按业态动态渲染 | 大 |
| **前端** | 供求大厅左侧按业态分组 | 中 |
| **前端** | 产品卡片组件适配多业态 | 中 |

### 5.3 实施路径建议

**阶段一：数据层改造**（1-2天）
1. 新增 `nht_product_schema` 表
2. 给 `nht_product` 添加 `schema_code` 字段
3. 为种蛋、鸡苗、肉产品添加分类和参数模板

**阶段二：后端适配**（1-2天）
1. 新增 Schema 查询 API
2. 修改 `SupplyCreateRequest` 和 `RequirementCreateRequest`
3. Service 层增加业态校验逻辑

**阶段三：前端改造**（2-3天）
1. 发布表单根据业态动态渲染
2. 品类选择器增加业态分组
3. 供求大厅左侧分类改造
4. 详情页适配不同业态的展示

---

## 六、附录

### 6.1 关键文件路径

| 类别 | 文件路径 |
|------|---------|
| **产品数据模型** | `backend/.../product/domain/NhtProduct.java` |
| **参数数据模型** | `backend/.../product_param/domain/NhtProductParam.java` |
| **供应DTO** | `backend/.../supply/dto/SupplyCreateRequest.java` |
| **需求DTO** | `backend/.../requirement/dto/RequirementCreateRequest.java` |
| **供应Service** | `backend/.../supply/service/impl/SupplyServiceImpl.java` |
| **产品API** | `frontend/src/api/product.ts` |
| **供应API** | `frontend/src/api/supply.ts` |
| **发布表单** | `frontend/src/views/MySupplyManageView.vue` |
| **质量标准** | `frontend/src/utils/qualityStandards.ts` |

### 6.2 相关数据库表

- `nht_product` - 产品分类表
- `nht_product_parameters` - 产品参数模板表
- `bus_supply` - 供应信息表
- `bus_requirement` - 需求信息表
- `nht_entity_tag` - 标签关联表
