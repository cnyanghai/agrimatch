<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.agrimatch.contract.mapper.ContractChangeLogMapper">

    <resultMap id="ChangeLogMap" type="com.agrimatch.contract.domain.BusContractChangeLog">
        <id column="id" property="id"/>
        <result column="contract_id" property="contractId"/>
        <result column="change_type" property="changeType"/>
        <result column="change_desc" property="changeDesc"/>
        <result column="before_json" property="beforeJson"/>
        <result column="after_json" property="afterJson"/>
        <result column="operator_user_id" property="operatorUserId"/>
        <result column="operator_ip" property="operatorIp"/>
        <result column="create_time" property="createTime"/>
    </resultMap>

    <insert id="insert" parameterType="com.agrimatch.contract.domain.BusContractChangeLog"
            useGeneratedKeys="true" keyProperty="id" keyColumn="id">
        INSERT INTO bus_contract_change_log
        (contract_id, change_type, change_desc, before_json, after_json, operator_user_id, operator_ip, create_time)
        VALUES
        (#{contractId}, #{changeType}, #{changeDesc}, #{beforeJson}, #{afterJson}, #{operatorUserId}, #{operatorIp}, NOW(3))
    </insert>

    <select id="selectByContractId" resultMap="ChangeLogMap">
        SELECT * FROM bus_contract_change_log
        WHERE contract_id = #{contractId}
        ORDER BY create_time DESC
    </select>

</mapper>

