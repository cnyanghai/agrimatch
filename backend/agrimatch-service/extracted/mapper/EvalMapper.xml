<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.agrimatch.eval.mapper.EvalMapper">

    <resultMap id="EvalMap" type="com.agrimatch.eval.domain.BusOrderEval">
        <id column="id" property="id"/>
        <result column="requirement_id" property="requirementId"/>
        <result column="supply_id" property="supplyId"/>
        <result column="from_user_id" property="fromUserId"/>
        <result column="to_company_id" property="toCompanyId"/>
        <result column="from_user_name" property="fromUserName"/>
        <result column="from_nick_name" property="fromNickName"/>
        <result column="to_company_name" property="toCompanyName"/>
        <result column="stars" property="stars"/>
        <result column="comment" property="comment"/>
        <result column="images_json" property="imagesJson"/>
        <result column="is_deleted" property="isDeleted"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <insert id="insert" parameterType="com.agrimatch.eval.domain.BusOrderEval"
            useGeneratedKeys="true" keyProperty="id" keyColumn="id">
        INSERT INTO bus_order_eval
        (requirement_id, supply_id, from_user_id, to_company_id, stars, comment, images_json, is_deleted, create_time, update_time)
        VALUES
        (#{requirementId}, #{supplyId}, #{fromUserId}, #{toCompanyId}, #{stars}, #{comment}, #{imagesJson}, 0, NOW(3), NOW(3))
    </insert>

    <select id="selectByCompany" resultMap="EvalMap">
        SELECT
            e.id, e.requirement_id, e.supply_id, e.from_user_id, e.to_company_id,
            fu.user_name AS from_user_name,
            fu.nick_name AS from_nick_name,
            tc.company_name AS to_company_name,
            e.stars, e.comment, e.images_json, e.is_deleted, e.create_time, e.update_time
        FROM bus_order_eval e
        LEFT JOIN sys_user fu ON fu.user_id = e.from_user_id AND fu.is_deleted = 0
        LEFT JOIN bus_company tc ON tc.id = e.to_company_id AND tc.is_deleted = 0
        WHERE e.to_company_id = #{toCompanyId}
          AND e.is_deleted = 0
        ORDER BY e.id DESC
        LIMIT 200
    </select>

</mapper>


